# H2 관련

[뒤로][toBack]

---

## 테이블

| title | description |
| :---: | :--- |
| `system_users` | 오케스트로 사용자 정보 |
| `system_properties` | 오케스트로 시스템 정보 |

### `system_users`

> 오케스트로 사용자 정보 

| column | alias | NN | TYPE | PK | FK | constraint |
| :--- | :--- | :---: | :---: | :---: | :---: | 
| `NO` | 번호 (인덱스) | Y | `INT` | Y | | |
| `ID` | 오케스트로 사용자ID | Y | `VARCHAR(30)` | | | |
| `PASSWORD` | 오케스트로 사용자 암호 | Y | `VARCHAR(200)` | | | |
| `ADMINISTRATIVE` | 관리자 권한여부 | N | `BOOLEAN` | | | |
| `NAME` | 오케스트로 사용자명 | Y | `VARCHAR(100)` | | | |
| `LAST_NAME` | 오케스트로 사용자명(성) | `VARCHAR(100)`  | | | |
| `PRINCIPAL` | 오케스트로 사용자 권한 | `VARCHAR(100)` | | | |
| `NAMESPACE` | ? | N | `VARCHAR(100)` | | | |
| `EMAIL` | 오케스트로 사용자 이메일 | N | `VARCHAR(50)` | | | |
| `AUTH_PROVIDER` | ? | N | `VARCHAR(100)` | | | |
| `ROLE_ID` | ? | N | `VARCHAR(100)` | | | |
| `LOGIN_COUNT` |  오케스트로 사용자 로그인 시도 회수 | N | `INT` | | | |
| `BLOCK_TIME` | ? | N |  `VARCHAR(14)` | | | |

```sql
-- 테이블 중복방지 생성
CREATE TABLE IF NOT EXISTS system_users (
	no                  int AUTO_INCREMENT PRIMARY KEY  NOT NULL
	, id                VARCHAR(30)                     NOT NULL
	, password          VARCHAR(200)                    NOT NULL
	, administrative    BOOLEAN
	, name              VARCHAR(100)                    NOT NULL
	, last_name         VARCHAR(100)
	, principal         VARCHAR(100)
	, namespace         VARCHAR(100)
	, email             VARCHAR(50)
	, auth_provider     VARCHAR(100)
	, role_id           VARCHAR(100)
	, login_count       INT
	, block_time        VARCHAR(14)
);

--- 관리자 사용자 등록
INSERT INTO system_users (
    no, id, password, administrative, name
    , last_name, principal, namespace, email, auth_provider
    , role_id, login_count, block_time
) SELECT
    1, 'admin', '1000:08b8ee8e392be3758eb3e6da5162e63f536b9baef34ecd6a:39d1ca299c9eb764c18a722d221e0e77f6156280f056b9b0', true, 'administrator'
    , '', '', '*', '', 'internal-authz'
    , '', 0, ''
FROM
    DUAL
WHERE NOT EXISTS (
    SELECT
        no, id, password, administrative, name
        , last_name, principal, namespace, email, auth_provider
        , role_id, login_count, block_time
    FROM
        system_users
    WHERE 1=1
    AND no = 1
);
```

### `system_properties` 

> 오케스트로 시스템 정보 

| column | alias | NN | TYPE | PK | FK | constraint |
| :--- | :--- | :---: | :---: | :---: | :---: | 
| `PROPERTY` | 속성 | Y | `VARCHAR(50)` | Y | | |
| `PROPERTY_VALUE` | 속성값 | Y | `VARCHAR(200)` | | | |


```sql
-- 테이블 중복방지 생성
CREATE TABLE IF NOT EXISTS system_properties (
	property            VARCHAR(50) PRIMARY KEY NOT NULL
	, property_value    VARCHAR(200)            NOT NULL
);
```

---

## 운영 데이터

### 설명

| item | description |
| :---: | :--- |
| `192.168.0.50` | `on20-manage` 주소 |
| `192.168.0.50:9999` | ? |
| `192.168.0.50:3000` | Graphana 도커 컨테이너 주소 |
| `192.168.0.50:250000` | 머신러닝 도커 컨테이너 주소 |

- 기본적으로 오케스트로 관리자 id/pw 정보는 동일함
- 오케스트로를 구성 시킬 환경정보를 알아야 함
  - hostname 또는 IP주소
    
### 쿼리

```sql
INSERT INTO system_properties(property,property_value) VALUES ('id'                      , 'admin');
INSERT INTO system_properties(property,property_value) VALUES ('password'                , 'admin!123');
INSERT INTO system_properties(property,property_value) VALUES ('ip'                      , '192.168.0.50');
INSERT INTO system_properties(property,property_value) VALUES ('vnc_ip'                  , '192.168.0.50');
INSERT INTO system_properties(property,property_value) VALUES ('vnc_port'                , '9999');
INSERT INTO system_properties(property,property_value) VALUES ('cpu_threshold'           , '80');
INSERT INTO system_properties(property,property_value) VALUES ('memory_threshold'        , '78');
INSERT INTO system_properties(property,property_value) VALUES ('grafana_uri'             , 'https://192.168.0.50:3000/d-solo/8CzwBk1mk/vm-metrics');
INSERT INTO system_properties(property,property_value) VALUES ('deepLearning_uri'        , 'https://192.168.0.50:25000/symphony/makeLearning');
INSERT INTO system_properties(property,property_value) VALUES ('symphony_power_controll' , 'FALSE');
INSERT INTO system_properties(property,property_value) VALUES ('login_limit'             , '5');
```


[toBack]: ../